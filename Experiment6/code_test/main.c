/*******************************************************

程序功能：LCD12864液晶测试

开发环境：Keil3

硬件环境：CEPARK多功能开发学习板/实验箱（2013版），STC12C5A60S2，11.0592M晶振
																							   
接线说明：单片机P1口与底板JP41排针相连，分别为：P10-D0, P11-D1，P12-D2，P13-D3，P14-D4，P15-D5，P16-D6，P17-D7；
          单片机P34~P37口与底板JP36相连，分别为：P34-RS,P35-RW,P36-EN，P37-CS1，CS2悬空		

跳线说明：无

实验现象：液晶屏显示图片

									 
论坛支持：http://bbs.cepark.com

淘宝店铺：http://cepark.taobao.com

作者：cepark 

时间：2013-01-01（元旦快乐！）



*******************************************************/



#include <REG52.H>

sbit LCD12864_RS  =  P3^4;	 //RS控制引脚
sbit LCD12864_RW  =  P3^3;	 //RW控制引脚
sbit LCD12864_EN  =  P3^2;	 //EN控制引脚
sbit LCD12864_PSB  =  P3^0;	  //模式选择引脚，ST7920控制器，1为8位并行接口，0为串行接口

#define LCDPORT P1		//数据引脚


void LCD12864_Init(void);		  //LCD12864初始化函数
void LCD12864_WriteInfomation(unsigned char ucData,bit bComOrData);	   
	//向LCD12864写入数据，bComOrData为1时写入的是数据，0时写入的是命令

void LCD12864_CheckBusy(void);		//忙检测函数
void LCD12864_DisplayImage(unsigned char code *ucImage);
void Delay(unsigned int uiCount);

unsigned char code ucPic[]={
			0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0xFF,0xF0,0x00,0x01,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x00,0x18,0x00,0x01,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xBF,0xFF,0xDC,0x00,0x01,
			0x80,0x00,0x1F,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xBF,0xFF,0xBC,0x00,0x01,
			0x80,0x00,0x30,0x00,0x01,0x80,0x00,0x00,0x00,0x00,0x01,0x7F,0xFF,0xB8,0x00,0x01,
			0x80,0x00,0x30,0x00,0x00,0x80,0x00,0x00,0x00,0x00,0x01,0x7F,0xFF,0x78,0x00,0x01,
			0x80,0x00,0x19,0xFF,0xFE,0xC0,0x00,0x00,0x00,0x00,0x02,0xFF,0xFF,0x70,0x00,0x01,
			0x80,0x00,0x18,0x00,0x00,0x40,0x00,0x00,0x00,0x00,0x02,0xFF,0xFE,0xF0,0x00,0x01,
			0x80,0x00,0x0C,0x01,0xFF,0x60,0x00,0x00,0x00,0x00,0x05,0xFF,0xFE,0xE0,0x00,0x01,
			0x80,0x00,0x0C,0x7F,0xD0,0x20,0x00,0x00,0x00,0x00,0x05,0xFF,0xFD,0xE0,0x00,0x01,
			0x80,0x00,0x06,0x00,0x0F,0xB0,0x00,0x00,0x00,0x00,0x0B,0xFF,0xFD,0xC0,0x00,0x01,
			0x80,0x00,0x06,0x03,0xFC,0x10,0x00,0x00,0x00,0x00,0x0B,0xFF,0xFB,0xC0,0x00,0x01,
			0x80,0x00,0x03,0x1F,0x00,0x18,0x00,0x00,0x00,0x00,0x17,0xFF,0xFB,0x80,0x00,0x01,
			0x80,0x00,0x03,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x17,0xFF,0xF7,0x80,0x00,0x01,
			0x80,0x00,0x01,0x80,0x00,0x0C,0x00,0x00,0x00,0x00,0x17,0xFF,0xF7,0x00,0x00,0x01,
			0x80,0x00,0x01,0x80,0x00,0x04,0x00,0x00,0x00,0x00,0x09,0xFF,0xEF,0x00,0x00,0x01,
			0x80,0x00,0x00,0xC0,0x00,0xF6,0x00,0x00,0x00,0x00,0x06,0x7F,0xEE,0x00,0x00,0x01,
			0x80,0x00,0x00,0xC0,0x03,0xC2,0x00,0x00,0x00,0x00,0x01,0x9F,0xDE,0x00,0x00,0x01,
			0x80,0x00,0x00,0x60,0x00,0x3B,0x00,0x00,0x00,0x00,0x00,0x67,0xDF,0x00,0x00,0x01,
			0x80,0x00,0x00,0x60,0x00,0xE3,0x00,0x00,0x00,0x00,0x00,0x19,0xBF,0x00,0x00,0x01,
			0x80,0x00,0x00,0x30,0x03,0x8E,0x00,0x00,0x00,0x00,0x00,0x06,0x3F,0x00,0x00,0x01,
			0x80,0x00,0x00,0x30,0x06,0x3C,0x00,0x00,0x00,0x00,0x00,0x01,0xFF,0x00,0x00,0x01,
			0x80,0x00,0x00,0x18,0x00,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x01,
			0x80,0x00,0x00,0x18,0x03,0xC0,0x00,0x00,0x00,0x00,0x00,0x0F,0x7F,0x80,0x00,0x01,
			0x80,0x00,0x00,0x0C,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x1F,0xC0,0x00,0x01,
			0x80,0x00,0x00,0x0C,0x3C,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x07,0xE0,0x00,0x01,
			0x80,0x00,0x00,0x06,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x1F,0xE0,0x00,0x01,
			0x80,0x00,0x00,0x07,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0xF8,0x3F,0xC0,0x00,0x01,
			0x80,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7E,0xFF,0x00,0x00,0x01,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0xFC,0x00,0x00,0x01,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0xF0,0x00,0x00,0x01,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xC0,0x00,0x00,0x01,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
			0x80,0x05,0x40,0x88,0x04,0x01,0x08,0x00,0x00,0x0A,0x81,0x10,0x04,0x00,0x20,0x01,
			0x80,0x79,0x21,0x08,0x02,0x21,0x49,0x00,0x00,0xF2,0x42,0x10,0x04,0x47,0x10,0x01,
			0x80,0x09,0x07,0xDF,0x7F,0xF7,0xAA,0x00,0x00,0x12,0x0F,0xBE,0x7F,0xE5,0xFE,0x01,
			0x80,0x7F,0xF4,0x51,0x08,0x81,0x2C,0x00,0x00,0xFF,0xE8,0xA2,0x44,0x47,0x00,0x01,
			0x80,0x09,0x04,0x61,0x08,0x81,0x7F,0x00,0x00,0x12,0x08,0xC2,0x7F,0xC5,0x4A,0x01,
			0x80,0x0B,0x24,0x51,0x08,0x83,0x81,0x00,0x00,0x16,0x48,0xA2,0x44,0x45,0x6A,0x01,
			0x80,0x1D,0x47,0xC9,0x05,0x05,0x01,0x00,0x00,0x3A,0x8F,0x92,0x44,0x47,0x52,0x01,
			0x80,0x68,0x84,0x49,0x05,0x05,0x7F,0x00,0x00,0xD1,0x08,0x92,0x7F,0xC5,0x6A,0x01,
			0x80,0x09,0x94,0x41,0x02,0x01,0x01,0x00,0x00,0x13,0x28,0x82,0x44,0x05,0x4A,0x01,
			0x80,0x0E,0x57,0xC1,0x0D,0x81,0x01,0x00,0x00,0x1C,0xAF,0x82,0x04,0x29,0x42,0x01,
			0x80,0x38,0x34,0x4E,0x70,0x71,0x7F,0x00,0x00,0x70,0x68,0x9C,0x03,0xEB,0x7E,0x01,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
			0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
			0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,};//图像数据

/******************************************************************************
函数名称：main
函数功能：主函数，程序如路口
入口参数：无
返回值：无
备注：无
*******************************************************************************/
void main(void)
{
	LCD12864_Init();   //初始化液晶
	
	LCD12864_DisplayImage(ucPic);
	while(1);

}

/******************************************************************************
函数名称：LCD12864_WriteInfomation
函数功能：向LCD12864写入命令或者数据
入口参数：ucData-要写入液晶的数据或者命令的内容
		  bComOrData-命令或者数据的标志位选择，0或者1，其中
		  	1：写入的是数据
			0：写入的是命令
返回值：无
备注：无
*******************************************************************************/
void LCD12864_WriteInfomation(unsigned char ucData,bit bComOrData)
{
	LCD12864_CheckBusy();	//忙检测
	LCD12864_RW = 0;	//拉低RW
	LCD12864_RS = bComOrData;	//根据标志位判断写入的是命令还是数据
	Delay(10);				  //延时，等待操作
	LCDPORT = ucData;		  //将数据送至数据端口
	LCD12864_EN = 1;		  //使能信号
	Delay(10);				  //延时
	LCD12864_EN = 0;		//按照时序来操作
	Delay(10);
}

/******************************************************************************
函数名称：LCD12864_Init
函数功能：LCD12864液晶初始化
入口参数：无
返回值：无
备注：无
*******************************************************************************/
void LCD12864_Init(void)
{
	Delay(400);//延时
	LCD12864_PSB = 1;	//8位并口工作模式
	Delay(150);//延时


	LCD12864_WriteInfomation(0x36,0); //基本指令集
	Delay(150);
	LCD12864_WriteInfomation(0x36,0);  //显示设置
	Delay(150);
	LCD12864_WriteInfomation(0x3E,0);	//光标设置
	Delay(150);
	LCD12864_WriteInfomation(0x0c,0);	//游标设置
	Delay(150);
	LCD12864_WriteInfomation(0x01,0);  //清屏
	Delay(150);
}

/******************************************************************************
函数名称：LCD12864_CheckBusy
函数功能：忙检测
入口参数：无
返回值：无
备注：使用变量i做计时，避免液晶在死循环处停滞。
*******************************************************************************/
void LCD12864_CheckBusy(void)
{
	unsigned char i = 250;	//局部变量
	LCD12864_RS = 0;	  //拉低
	LCD12864_RW = 1;	  //拉高
	LCD12864_EN = 1;	  //使能
	while((i > 0) && (P0 & 0x80))i--;  //判断忙标志位
	LCD12864_EN = 0;	  //释放
}

/******************************************************************************
函数名称：LCD12864_DisplayImage
函数功能：显示一副图像
入口参数：无
返回值：无
备注：无
*******************************************************************************/
void LCD12864_DisplayImage(unsigned char code *ucImage)
{
	unsigned char i,j;
	for(i = 0;i < 32;i++)
	{
		LCD12864_WriteInfomation((0x80 + i),0);
		LCD12864_WriteInfomation(0x80,0);
		for(j = 0;j < 16;j++)
		{
			LCD12864_WriteInfomation(*ucImage,1);
			ucImage++;
		}
	}

	for(i = 0;i < 32;i++)
	{
		LCD12864_WriteInfomation((0x80 + i),0);
		LCD12864_WriteInfomation(0x88,0);
		for(j = 0;j < 16;j++)
		{
			LCD12864_WriteInfomation(*ucImage,1);
			ucImage++;
		}
	}
}

/******************************************************************************
函数名称：Delay
函数功能：延时函数
入口参数：uiCount-延时参数
返回值：无
备注：无
*******************************************************************************/
void Delay(unsigned int uiCount)
{
	while(uiCount--);
}



/****************end of line3**********************/
/****************end of line2**********************/
/****************end of line1**********************/